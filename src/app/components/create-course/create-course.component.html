<!-- Create Course/Package Modal -->
<div class="modal fade show" *ngIf="showModal" tabindex="-1" role="dialog" style="display: block; background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered modal-md"> <!-- متوسط الحجم -->
    <div class="modal-content rounded-4 shadow-lg p-3" style="border: none; overflow: hidden;">

      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-bold">
          {{ courseForm.get('type')?.value === 'course' ? 'Create New Course' : 'Create New Package' }}
        </h5>
        <button type="button" class="btn-close" (click)="showModal = false"></button>
      </div>

      <div class="modal-body pt-0">
        <form [formGroup]="courseForm" (ngSubmit)="onSubmit()">
          
          <!-- Type Selector -->
          <div class="mb-3">
            <label class="form-label small fw-semibold">Type</label>
            <select formControlName="type" class="form-select form-select-sm">
              <option value="course">Course</option>
              <option value="package">Package</option>
            </select>
          </div>

          <!-- Course Form -->
          <ng-container *ngIf="courseForm.get('type')?.value === 'course'">
            <div class="mb-3">
              <label class="form-label small fw-semibold">Course Title</label>
              <input type="text" formControlName="title" class="form-control form-control-sm" placeholder="Enter course title">
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Description</label>
              <textarea formControlName="description" class="form-control form-control-sm" rows="2" placeholder="Course description"></textarea>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small fw-semibold">Category</label>
                <select formControlName="categoryID" class="form-select form-select-sm">
                  <option value="" disabled>Select category</option>
                  <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label small fw-semibold">Level</label>
                <select formControlName="level" class="form-select form-select-sm">
                  <option value="" disabled>Select level</option>
                  <option value="beginner">Beginner</option>
                  <option value="intermediate">Intermediate</option>
                  <option value="advanced">Advanced</option>
                </select>
              </div>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small fw-semibold">Price ($)</label>
                <input type="number" formControlName="price" class="form-control form-control-sm" min="0">
              </div>
              <div class="col-6">
                <label class="form-label small fw-semibold">Duration (hrs)</label>
                <input type="number" formControlName="estimatedDuration" class="form-control form-control-sm" min="1">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Language</label>
              <input type="text" formControlName="language" class="form-control form-control-sm" placeholder="English">
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Cover Image</label>
              <input type="file" (change)="onFileSelected($event, 'coverImage')" class="form-control form-control-sm" accept="image/*">
            </div>
          </ng-container>

          <!-- Package Form -->
          <ng-container *ngIf="courseForm.get('type')?.value === 'package'">
            <div class="mb-3">
              <label class="form-label small fw-semibold">Package Title</label>
              <input type="text" formControlName="title" class="form-control form-control-sm" placeholder="Enter package title">
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Description</label>
              <textarea formControlName="description" class="form-control form-control-sm" rows="2" placeholder="Package description"></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-semibold">Discount Percentage</label>
              <input type="number" formControlName="discountPercentage" class="form-control form-control-sm" min="0" max="100">
            </div>
            <div class="mb-3">
              <label class="form-label small fw-semibold">Price ($)</label>
              <input type="number" formControlName="price" class="form-control form-control-sm" min="0">
            </div>
            <div class="mb-3">
              <label class="form-label small fw-semibold">Cover Image</label>
              <input type="file" (change)="onFileSelected($event, 'coverImage')" class="form-control form-control-sm" accept="image/*">
            </div>
            <!-- PackageCourses FormArray -->
            <div class="mb-2" formArrayName="packageCourses">
              <label class="form-label small">Add Courses</label> 
              <div *ngFor="let c of packageCourses.controls; let i=index" class="d-flex mb-1 align-items-center"> 
                <select [formControlName]="i" class="form-select form-select-sm me-1"> 
                  <option value="" disabled>Select course</option> 
                  <option *ngFor="let myCourse of myCourses" [value]="myCourse._id">{{ myCourse.title }}</option> 
                </select> 
                <button type="button" class="btn btn-sm btn-danger" (click)="removePackageCourse(i)">Remove</button> 
              </div> 
              <button type="button" class="btn btn-sm btn-outline-primary mt-1" (click)="addPackageCourse('')">+ Add Course</button> 
            </div>

            <!-- KeySkills FormArray -->
            <div class="mb-2" formArrayName="keySkills"> 
              <label class="form-label small">Key Skills</label> 
              <div *ngFor="let s of keySkills.controls; let i=index" class="d-flex mb-1"> 
                <input [formControlName]="i" class="form-control form-control-sm me-1" placeholder="Skill"> 
                <button type="button" class="btn btn-sm btn-danger" (click)="removeKeySkill(i)">Remove</button> 
              </div> 
              <button type="button" class="btn btn-sm btn-outline-primary mt-1" (click)="addKeySkill()">+ Add Skill</button> 
            </div>
            <!-- CareerPaths FormArray -->
            <div class="mb-2" formArrayName="careerPaths"> 
              <label class="form-label small">Career Paths</label> 
              <div *ngFor="let cp of careerPaths.controls; let i=index" class="d-flex mb-1"> 
                <input [formControlName]="i" class="form-control form-control-sm me-1" placeholder="Career Path"> 
                <button type="button" class="btn btn-sm btn-danger" (click)="removeCareerPath(i)">Remove</button> 
              </div> 
              <button type="button" class="btn btn-sm btn-outline-primary mt-1" (click)="addCareerPath()">+ Add Career Path</button> 
            </div> 
          </ng-container>

          <button type="submit" class="btn btn-primary w-100 mt-2 fw-bold">
            {{ courseForm.get('type')?.value === 'course' ? 'Create Course' : 'Create Package' }}
          </button>

        </form>
      </div>
    </div>
  </div>
</div>
